<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>內科醫學編碼互動式平台 (ICD-10-CM)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in-up': 'fadeInUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* 自定義捲軸樣式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Lucide Icon 轉接層 (修正版) ---
        // 修正說明：Lucide 新版移除了 icon 物件上的 .toSvg() 方法
        // 改用 lucide.createElement() 來生成 DOM，再轉為字串
        const IconWrapper = ({ name, color, size, className, strokeWidth, ...props }) => {
            // Lucide CDN 暴露的是 `lucide.icons` 物件
            const iconDef = lucide.icons[name];
            
            if (!iconDef) {
                console.warn(`Icon ${name} not found`);
                return null;
            }

            try {
                // 使用 Lucide 的 helper 建立 SVG DOM 元素
                const svgElement = lucide.createElement(iconDef);

                // 設定我們需要的屬性 (會覆蓋預設值)
                svgElement.setAttribute('width', size || 24);
                svgElement.setAttribute('height', size || 24);
                svgElement.setAttribute('stroke', color || "currentColor");
                svgElement.setAttribute('stroke-width', strokeWidth || 2);
                
                if (className) {
                    // 處理既有的 class 與傳入的 className
                    const existingClass = svgElement.getAttribute('class') || '';
                    svgElement.setAttribute('class', `${existingClass} ${className}`.trim());
                }

                // 將其他 React props 轉為屬性
                Object.entries(props).forEach(([key, value]) => {
                    if (value !== undefined && value !== null) {
                        svgElement.setAttribute(key, value);
                    }
                });

                // 將 DOM 轉回 HTML 字串以供 React 使用
                return <span dangerouslySetInnerHTML={{ __html: svgElement.outerHTML }} style={{ display: 'inline-flex', alignItems: 'center' }} />;
            } catch (e) {
                console.error(`Failed to render icon: ${name}`, e);
                return null;
            }
        };

        // 建立原始代碼中使用的所有 Icon 元件
        const iconsList = [
            'Stethoscope', 'Search', 'ArrowRight', 'FileText', 'CheckCircle', 'AlertTriangle', 
            'Copy', 'Trash2', 'Database', 'Activity', 'XCircle', 'Download', 'Upload', 'Plus', 
            'Save', 'Settings', 'List', 'Edit2', 'RotateCcw', 'Filter', 'ArrowUpDown', 
            'ArrowUp', 'ArrowDown', 'Code', 'X', 'Info'
        ];

        const Icons = iconsList.reduce((acc, key) => {
            acc[key] = (props) => <IconWrapper name={key} {...props} />;
            return acc;
        }, {});

        const { 
            Stethoscope, Search, ArrowRight, FileText, CheckCircle, AlertTriangle, 
            Copy, Trash2, Database, Activity, XCircle, Download, Upload, Plus, 
            Save, Settings, List, Edit2, RotateCcw, Filter, ArrowUpDown, 
            ArrowUp, ArrowDown, Code, X, Info 
        } = Icons;

        // --- 原始應用程式代碼開始 ---

        // 1. 提示訊息 (Toast)
        const Toast = ({ message, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className="fixed bottom-5 right-5 bg-slate-800 text-white px-6 py-3 rounded-lg shadow-lg flex items-center z-[100] animate-fade-in-up">
                    <Info className="w-5 h-5 mr-3 text-blue-400" />
                    <span className="text-sm font-medium">{message}</span>
                    <button onClick={onClose} className="ml-4 text-slate-400 hover:text-white">
                        <X className="w-4 h-4" />
                    </button>
                </div>
            );
        };

        // 2. 確認對話框 (Modal)
        const ConfirmModal = ({ isOpen, title, message, onConfirm, onCancel, confirmText = "確定", confirmColor = "bg-blue-600 hover:bg-blue-700" }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[100] backdrop-blur-sm p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-100">
                        <div className="p-6">
                            <h3 className="text-lg font-bold text-slate-800 mb-2">{title}</h3>
                            <p className="text-sm text-slate-600 whitespace-pre-line leading-relaxed">{message}</p>
                        </div>
                        <div className="bg-slate-50 px-6 py-4 flex justify-end space-x-3">
                            <button 
                                onClick={onCancel}
                                className="px-4 py-2 bg-white border border-slate-300 text-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors"
                            >
                                取消
                            </button>
                            <button 
                                onClick={onConfirm}
                                className={`px-4 py-2 text-white rounded-lg text-sm font-medium shadow-sm transition-colors ${confirmColor}`}
                            >
                                {confirmText}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // 定義器官/系統分類
        const ORGAN_CATEGORIES = [
            { value: 'Respiratory', label: '呼吸系統 (Respiratory)', color: 'bg-teal-100 text-teal-800' },
            { value: 'Cardiovascular', label: '心血管系統 (Cardiovascular)', color: 'bg-rose-100 text-rose-800' },
            { value: 'Renal', label: '腎臟泌尿 (Renal/Urinary)', color: 'bg-blue-100 text-blue-800' },
            { value: 'Digestive', label: '消化系統 (Digestive)', color: 'bg-orange-100 text-orange-800' },
            { value: 'Endocrine', label: '內分泌代謝 (Endocrine)', color: 'bg-yellow-100 text-yellow-800' },
            { value: 'Neurological', label: '神經系統 (Neurological)', color: 'bg-purple-100 text-purple-800' },
            { value: 'Infectious', label: '感染/敗血症 (Infectious)', color: 'bg-red-100 text-red-800' },
            { value: 'Other', label: '其他 (Other)', color: 'bg-slate-100 text-slate-800' }
        ];

        // 這裡填入完整的大型 JSON 資料庫 (INITIAL_DATABASE)
        // 為了節省空間，這裡從上方的 React 代碼中複製貼上完整的 INITIAL_DATABASE
        const INITIAL_DATABASE = [
            { "id": "E10.9", "keywords": ["TYPE 1 DM", "T1DM", "INSULIN DEPENDENT DIABETES", "第一型糖尿病"], "standard": "Type 1 diabetes mellitus without complications", "code": "E10.9", "type": "broad", "organ": "Endocrine", "note": "" },
            { "id": "G45.9", "keywords": ["TIA", "TRANSIENT ISCHEMIC ATTACK", "暫時性腦缺血", "MINI STROKE"], "standard": "Transient cerebral ischemic attack, unspecified", "code": "G45.9", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "I69.20", "keywords": ["OLD ICH", "OLD HEMORRHAGIC STROKE", "陳舊性腦出血"], "standard": "Unspecified sequelae of other nontraumatic intracranial hemorrhage", "code": "I69.20", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "I69.30", "keywords": ["OLD CEREBRAL INFARCTION", "OLD INFARCTION", "OLD ISCHEMIC STROKE", "陳舊性腦梗塞", "I69", "OLD CVA", "PRIOR STROKE", "陳舊性中風", "中風後遺症"], "standard": "Unspecified sequelae of cerebral infarction", "code": "I69.30", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "I69.90", "keywords": ["OLD CVA", "OLD STROKE", "中風後遺症", "CVA SEQUELA"], "standard": "Unspecified sequelae of unspecified cerebrovascular disease", "code": "I69.90", "type": "broad", "organ": "Neurological", "note": "若已知是梗塞或出血，請用 I69.30 或 I69.20" },
            { "id": "S06.359S", "keywords": ["OLD TRAUMATIC ICH", "OLD TRAUMATIC BRAIN HEMORRHAGE", "陳舊性創傷性腦出血"], "standard": "Traumatic hemorrhage of left cerebrum with loss of consciousness of unspecified duration, sequela", "code": "S06.359S", "type": "exact", "organ": "Neurological", "note": "S06.3x9S: Traumatic ICH sequela (unspecified side)" },
            { "id": "S06.379S", "keywords": ["OLD TRAUMATIC CEREBELLAR HEMORRHAGE", "陳舊性創傷性小腦出血"], "standard": "Contusion, laceration, and hemorrhage of cerebellum with loss of consciousness of unspecified duration, sequela", "code": "S06.379S", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "S06.4X9S", "keywords": ["OLD EDH", "OLD EPIDURAL HEMORRHAGE", "陳舊性硬腦膜外出血"], "standard": "Epidural hemorrhage with loss of consciousness of unspecified duration, sequela", "code": "S06.4X9S", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "S06.5X9S", "keywords": ["OLD SDH", "OLD SUBDURAL HEMORRHAGE", "陳舊性硬腦膜下出血"], "standard": "Traumatic subdural hemorrhage with loss of consciousness of unspecified duration, sequela", "code": "S06.5X9S", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "S06.6X9S", "keywords": ["OLD SAH", "OLD SUBARACHNOID HEMORRHAGE", "陳舊性蜘蛛膜下腔出血"], "standard": "Traumatic subarachnoid hemorrhage with loss of consciousness of unspecified duration, sequela", "code": "S06.6X9S", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "G20", "keywords": ["PARKINSON'S DISEASE", "PD", "巴金森氏症", "帕金森氏症"], "standard": "Parkinson's disease", "code": "G20", "type": "broad", "organ": "Neurological", "note": "" },
            { "id": "F20.1", "keywords": ["SCHIZOPHRENIA", "思覺失調症", "精神分裂症"], "standard": "Disorganized schizophrenia", "code": "F20.1", "type": "exact", "organ": "Neurological", "note": "F20.9 為 Schizophrenia, unspecified" },
            { "id": "F03.91", "keywords": ["DEMENTIA", "失智症", "癡呆症"], "standard": "Unspecified dementia with behavioral disturbance", "code": "F03.91", "type": "broad", "organ": "Neurological", "note": "F03.90: Without behavioral disturbance" },
            { "id": "F02.80", "keywords": ["DEMENTIA RELATED OTHER DISEASE", "SECONDARY DEMENTIA", "其他疾病引起之失智症"], "standard": "Dementia in other diseases classified elsewhere without behavioral disturbance", "code": "F02.80", "type": "context", "organ": "Neurological", "note": "需先編碼潛在疾病 (如 G20 Parkinson's)" },
            { "id": "G30.9", "keywords": ["ALZHEIMER'S DISEASE", "ALZHEIMER", "阿茲海默症"], "standard": "Alzheimer's disease, unspecified", "code": "G30.9", "type": "exact", "organ": "Neurological", "note": "通常需搭配 F02.80 或 F02.81 (Dementia in Alzheimer's)" },
            { "id": "G30.8", "keywords": ["OTHER ALZHEIMER'S DISEASE", "其他阿茲海默症"], "standard": "Other Alzheimer's disease", "code": "G30.8", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "F05", "keywords": ["DELIRIUM", "譫妄", "ACUTE CONFUSIONAL STATE"], "standard": "Delirium due to known physiological condition", "code": "F05", "type": "exact", "organ": "Neurological", "note": "需編碼潛在生理病因" },
            { "id": "F41.9", "keywords": ["ANXIETY", "ANXIETY DISORDER", "焦慮症"], "standard": "Anxiety disorder, unspecified", "code": "F41.9", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "G40.909", "keywords": ["EPILEPSY INTERMITTENT", "SEIZURE DISORDER", "癲癇", "SEIZURE"], "standard": "Epilepsy, unspecified, not intractable, without status epilepticus", "code": "G40.909", "type": "exact", "organ": "Neurological", "note": "R56.9 為 Unspecified convulsions (非癲癇診斷)" },
            { "id": "G40.919", "keywords": ["EPILEPSY PERSISTENT", "INTRACTABLE EPILEPSY", "頑固性癲癇"], "standard": "Epilepsy, unspecified, intractable, without status epilepticus", "code": "G40.919", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "G93.40", "keywords": ["ENCEPHALOPATHY", "腦病變"], "standard": "Encephalopathy, unspecified", "code": "G93.40", "type": "broad", "organ": "Neurological", "note": "代謝性腦病變請用 G93.41" },
            { "id": "R54", "keywords": ["AGE-RELATED PHYSICAL DEBILITY", "DEBILITY", "FRAILTY", "衰弱", "老邁"], "standard": "Age-related physical debility", "code": "R54", "type": "exact", "organ": "Other", "note": "" },
            { "id": "Z87.11", "keywords": ["PUD HISTORY", "HISTORY OF PEPTIC ULCER", "消化性潰瘍病史"], "standard": "Personal history of peptic ulcer disease", "code": "Z87.11", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "K29.70", "keywords": ["GASTRITIS", "胃炎"], "standard": "Gastritis, unspecified, without bleeding", "code": "K29.70", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "K22.0", "keywords": ["ACHALASIA", "ESOPHAGEAL ACHALASIA", "食道弛緩不能症", "賁門失弛緩"], "standard": "Achalasia of cardia", "code": "K22.0", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "K21.9", "keywords": ["GERD WITHOUT ESOPHAGITIS", "GERD", "胃食道逆流"], "standard": "Gastro-esophageal reflux disease without esophagitis", "code": "K21.9", "type": "exact", "organ": "Digestive", "note": "若合併食道炎請用 K21.0" },
            { "id": "K25.9", "keywords": ["GU", "GASTRIC ULCER", "胃潰瘍"], "standard": "Gastric ulcer, unspecified as acute or chronic, without hemorrhage or perforation", "code": "K25.9", "type": "exact", "organ": "Digestive", "note": "若出血請用 K25.0" },
            { "id": "K26.0", "keywords": ["DU WITH BLEEDING", "DUODENAL ULCER WITH HEMORRHAGE", "十二指腸潰瘍出血"], "standard": "Acute duodenal ulcer with hemorrhage", "code": "K26.0", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "K26.9", "keywords": ["DU", "DUODENAL ULCER", "十二指腸潰瘍"], "standard": "Duodenal ulcer, unspecified as acute or chronic, without hemorrhage or perforation", "code": "K26.9", "type": "exact", "organ": "Digestive", "note": "若出血請用 K26.0" },
            { "id": "K43.9", "keywords": ["VENTRAL HERNIA", "INCISIONAL HERNIA", "腹壁疝氣"], "standard": "Ventral hernia without obstruction or gangrene", "code": "K43.9", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "K75.0", "keywords": ["LIVER ABSCESS", "HEPATIC ABSCESS", "肝膿瘍"], "standard": "Abscess of liver", "code": "K75.0", "type": "exact", "organ": "Digestive", "note": "若為阿米巴性請用 A06.4" },
            { "id": "A06.4", "keywords": ["AMOEBIC LIVER ABSCESS", "AMEBIC LIVER ABSCESS", "阿米巴肝膿瘍"], "standard": "Amebic liver abscess", "code": "A06.4", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "K74.60", "keywords": ["LIVER CIRRHOSIS", "LC", "肝硬化"], "standard": "Unspecified cirrhosis of liver", "code": "K74.60", "type": "broad", "organ": "Digestive", "note": "若為酒精性請用 K70.3-" },
            { "id": "K70.30", "keywords": ["ALCOHOLIC LIVER CIRRHOSIS", "ALCOHOLIC LC", "酒精性肝硬化"], "standard": "Alcoholic cirrhosis of liver without ascites", "code": "K70.30", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "K70.31", "keywords": ["ALCOHOLIC LIVER CIRRHOSIS WITH ASCITES", "酒精性肝硬化合併腹水"], "standard": "Alcoholic cirrhosis of liver with ascites", "code": "K70.31", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "K70.9", "keywords": ["ALCOHOLIC LIVER DISEASE", "ALD", "酒精性肝病"], "standard": "Alcoholic liver disease, unspecified", "code": "K70.9", "type": "broad", "organ": "Digestive", "note": "" },
            { "id": "I85.00", "keywords": ["ESOPHAGEAL VARICES", "EV", "食道靜脈曲張"], "standard": "Esophageal varices without bleeding", "code": "I85.00", "type": "exact", "organ": "Digestive", "note": "若出血請用 I85.01" },
            { "id": "K72.01", "keywords": ["HEPATIC ENCEPHALOPATHY", "HEPATIC COMA", "肝昏迷", "肝腦病變"], "standard": "Acute and subacute hepatic failure with coma", "code": "K72.01", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "R18.8", "keywords": ["ASCITES", "腹水"], "standard": "Other ascites", "code": "R18.8", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "R17", "keywords": ["JAUNDICE", "ICTERUS", "黃疸"], "standard": "Unspecified jaundice", "code": "R17", "type": "broad", "organ": "Digestive", "note": "" },
            { "id": "B18.1", "keywords": ["CHRONIC HEPATITIS B", "CHB", "慢性B型肝炎", "HBV"], "standard": "Chronic viral hepatitis B without delta-agent", "code": "B18.1", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "B18.2", "keywords": ["CHRONIC HEPATITIS C", "CHC", "慢性C型肝炎", "HCV"], "standard": "Chronic viral hepatitis C", "code": "B18.2", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "B18.8", "keywords": ["CHRONIC VIRAL HEPATITIS", "其他慢性病毒性肝炎"], "standard": "Other chronic viral hepatitis", "code": "B18.8", "type": "broad", "organ": "Digestive", "note": "" },
            { "id": "Z22.51", "keywords": ["HEPATITIS B CARRIER", "HBSAG CARRIER", "B肝帶原"], "standard": "Carrier of viral hepatitis B", "code": "Z22.51", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "R94.5", "keywords": ["ABNORMAL LIVER FUNCTION", "GOT/GPT ELEVATION", "LIVER FUNCTION ABNORMALITY", "肝功能異常"], "standard": "Abnormal results of liver function studies", "code": "R94.5", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "N20.0", "keywords": ["CALCULUS OF KIDNEY", "RENAL STONE", "NEPHROLITHIASIS", "腎結石"], "standard": "Calculus of kidney", "code": "N20.0", "type": "exact", "organ": "Renal", "note": "" },
            { "id": "N20.1", "keywords": ["CALCULUS OF URETER", "URETERAL STONE", "輸尿管結石"], "standard": "Calculus of ureter", "code": "N20.1", "type": "exact", "organ": "Renal", "note": "" },
            { "id": "N13.1", "keywords": ["HYDRONEPHROSIS", "腎水腫"], "standard": "Hydronephrosis with ureteral stricture, not elsewhere classified", "code": "N13.1", "type": "exact", "organ": "Renal", "note": "N13.30 為未明示原因之腎水腫" },
            { "id": "N18.1", "keywords": ["CKD STAGE 1", "CHRONIC KIDNEY DISEASE STAGE 1"], "standard": "Chronic kidney disease, stage 1", "code": "N18.1", "type": "exact", "organ": "Renal", "note": "" },
            { "id": "N18.2", "keywords": ["CKD STAGE 2", "CHRONIC KIDNEY DISEASE STAGE 2"], "standard": "Chronic kidney disease, stage 2 (mild)", "code": "N18.2", "type": "exact", "organ": "Renal", "note": "" },
            { "id": "N18.30", "keywords": ["CKD STAGE 3", "CHRONIC KIDNEY DISEASE STAGE 3"], "standard": "Chronic kidney disease, stage 3 unspecified", "code": "N18.30", "type": "broad", "organ": "Renal", "note": "N18.31 (3a), N18.32 (3b)" },
            { "id": "N18.4", "keywords": ["CKD STAGE 4", "CHRONIC KIDNEY DISEASE STAGE 4"], "standard": "Chronic kidney disease, stage 4 (severe)", "code": "N18.4", "type": "exact", "organ": "Renal", "note": "" },
            { "id": "N18.5", "keywords": ["CKD STAGE 5", "CHRONIC KIDNEY DISEASE STAGE 5"], "standard": "Chronic kidney disease, stage 5", "code": "N18.5", "type": "exact", "organ": "Renal", "note": "" },
            { "id": "N18.6", "keywords": ["ESRD", "END STAGE RENAL DISEASE", "末期腎病"], "standard": "End stage renal disease", "code": "N18.6", "type": "exact", "organ": "Renal", "note": "Z99.2 為洗腎狀態" },
            { "id": "N18.9", "keywords": ["CKD", "CHRONIC KIDNEY DISEASE", "慢性腎臟病"], "standard": "Chronic kidney disease, unspecified", "code": "N18.9", "type": "broad", "organ": "Renal", "note": "" },
            { "id": "E87.2", "keywords": ["ACIDOSIS", "METABOLIC ACIDOSIS", "酸中毒"], "standard": "Acidosis", "code": "E87.2", "type": "exact", "organ": "Endocrine", "note": "" },
            { "id": "E87.0", "keywords": ["HYPERNATREMIA", "HYPER-NA", "高血鈉"], "standard": "Hyperosmolality and hypernatremia", "code": "E87.0", "type": "exact", "organ": "Endocrine", "note": "" },
            { "id": "I51.7", "keywords": ["CARDIOMEGALY", "ENLARGED HEART", "心臟擴大"], "standard": "Cardiomegaly", "code": "I51.7", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "I21.9", "keywords": ["AMI", "ACUTE MYOCARDIAL INFARCTION", "急性心肌梗塞", "HEART ATTACK"], "standard": "Acute myocardial infarction, unspecified", "code": "I21.9", "type": "broad", "organ": "Cardiovascular", "note": "建議細分 STEMI (I21.0-I21.3) 或 NSTEMI (I21.4)" },
            { "id": "I24.0", "keywords": ["ACS", "ACUTE CORONARY THROMBOSIS", "急性冠狀動脈血栓"], "standard": "Acute coronary thrombosis not resulting in myocardial infarction", "code": "I24.0", "type": "exact", "organ": "Cardiovascular", "note": "若已發展為心肌梗塞請改用 I21.-" },
            { "id": "I25.10", "keywords": ["CAD", "CORONARY ARTERY DISEASE", "冠狀動脈疾病", "ASCVD"], "standard": "Atherosclerotic heart disease of native coronary artery without angina pectoris", "code": "I25.10", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "I27.81", "keywords": ["COR PULMONALE", "肺源性心臟病"], "standard": "Cor pulmonale (chronic)", "code": "I27.81", "type": "exact", "organ": "Cardiovascular", "note": "急性肺心症請用 I26.0-" },
            { "id": "I27.0", "keywords": ["PRIMARY PULMONARY HYPERTENSION", "PRIMARY PUL HTN", "PPH", "原發性肺高壓"], "standard": "Primary pulmonary hypertension", "code": "I27.0", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "I27.2", "keywords": ["SECONDARY PULMONARY HYPERTENSION", "SECONDARY PUL HTN", "繼發性肺高壓"], "standard": "Other secondary pulmonary hypertension", "code": "I27.2", "type": "broad", "organ": "Cardiovascular", "note": "通常需加註潛在病因 (如 I27.21, I27.22)" },
            { "id": "I47.1", "keywords": ["SVT", "SUPRAVENTRICULAR TACHYCARDIA", "心室上頻脈"], "standard": "Supraventricular tachycardia", "code": "I47.1", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "I49.9", "keywords": ["CARDIAC ARRHYTHMIA", "ARRHYTHMIA", "心律不整"], "standard": "Cardiac arrhythmia, unspecified", "code": "I49.9", "type": "broad", "organ": "Cardiovascular", "note": "" },
            { "id": "I82.40", "keywords": ["DVT", "DEEP VEIN THROMBOSIS", "深部靜脈栓塞"], "standard": "Acute embolism and thrombosis of unspecified deep veins of unspecified lower extremity", "code": "I82.40", "type": "broad", "organ": "Cardiovascular", "note": "建議指定左/右側及靜脈部位" },
            { "id": "I71.9", "keywords": ["AORTIC ANEURYSM", "主動脈瘤"], "standard": "Aortic aneurysm of unspecified site, without rupture", "code": "I71.9", "type": "broad", "organ": "Cardiovascular", "note": "" },
            { "id": "I71.4", "keywords": ["AAA", "ABDOMINAL AORTIC ANEURYSM", "ABDOMINAL ANEURYSM", "腹主動脈瘤"], "standard": "Abdominal aortic aneurysm, without rupture", "code": "I71.4", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "Z95.0", "keywords": ["ON PACEMAKER", "PACEMAKER STATUS", "裝有心律調節器"], "standard": "Presence of cardiac pacemaker", "code": "Z95.0", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "I31.3", "keywords": ["PERICARDIAL EFFUSION", "心包膜積水"], "standard": "Pericardial effusion (noninflammatory)", "code": "I31.3", "type": "exact", "organ": "Cardiovascular", "note": "I30.9 為急性心包膜積水" },
            { "id": "I73.9", "keywords": ["PAOD", "PERIPHERAL ARTERIAL OCCLUSIVE DISEASE", "周邊動脈阻塞疾病", "PVD"], "standard": "Peripheral vascular disease, unspecified", "code": "I73.9", "type": "broad", "organ": "Cardiovascular", "note": "若有間歇性跛行可考慮 I73.9 或更特定代碼" },
            { "id": "I96", "keywords": ["GANGRENE", "壞疽"], "standard": "Gangrene, not elsewhere classified", "code": "I96", "type": "exact", "organ": "Cardiovascular", "note": "若為糖尿病足壞疽請優先使用 E11.52 (Type 2 DM with diabetic peripheral angiopathy with gangrene)" },
            { "id": "J44.0", "keywords": ["COPD WITH 2ND INFECTION", "COPD WITH PNEUMONIA", "慢阻肺合併感染"], "standard": "Chronic obstructive pulmonary disease with (acute) lower respiratory infection", "code": "J44.0", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J85.2", "keywords": ["LUNG ABSCESS WITHOUT PNEUMONIA", "LUNG ABSCESS", "肺膿瘍"], "standard": "Abscess of lung without pneumonia", "code": "J85.2", "type": "exact", "organ": "Respiratory", "note": "若合併肺炎請用 J85.1" },
            { "id": "J34.2", "keywords": ["NASAL SEPTUM DEVIATION", "NSD", "鼻中膈彎曲"], "standard": "Deviated nasal septum", "code": "J34.2", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J93.0", "keywords": ["PNEUMOTHORAX", "SPONTANEOUS PNEUMOTHORAX", "氣胸"], "standard": "Spontaneous tension pneumothorax", "code": "J93.0", "type": "exact", "organ": "Respiratory", "note": "J93.9 為未明示之氣胸" },
            { "id": "R09.1", "keywords": ["PLEURISY", "PLEURITIS", "肋膜炎"], "standard": "Pleurisy", "code": "R09.1", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J94.2", "keywords": ["HEMOTHORAX", "血胸"], "standard": "Hemothorax", "code": "J94.2", "type": "exact", "organ": "Respiratory", "note": "創傷性血胸請用 S27.1" },
            { "id": "J84.10", "keywords": ["PULMONARY FIBROSIS", "LUNG FIBROSIS", "肺纖維化"], "standard": "Pulmonary fibrosis, unspecified", "code": "J84.10", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J84.112", "keywords": ["IPF", "IDIOPATHIC PULMONARY FIBROSIS", "特發性肺纖維化"], "standard": "Idiopathic pulmonary fibrosis", "code": "J84.112", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J98.2", "keywords": ["PNEUMOMEDIASTINUM", "SUBCUTANEOUS EMPHYSEMA", "縱膈腔氣腫", "皮下氣腫"], "standard": "Interstitial emphysema", "code": "J98.2", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "R04.0", "keywords": ["EPISTAXIS", "NOSE BLEEDING", "流鼻血"], "standard": "Epistaxis", "code": "R04.0", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J60", "keywords": ["COALWORKER PNEUMOCONIOSIS", "CWP", "礦工肺", "煤肺症"], "standard": "Coalworker's pneumoconiosis", "code": "J60", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J64", "keywords": ["PNEUMOCONIOSIS", "塵肺症"], "standard": "Unspecified pneumoconiosis", "code": "J64", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "K12.30", "keywords": ["ORAL ULCER", "MOUTH ULCER", "口腔潰瘍"], "standard": "Oral mucositis (ulcerative), unspecified", "code": "K12.30", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "Z00.00", "keywords": ["HEALTH EXAM NORMAL", "CHECK-UP NORMAL", "健康檢查正常", "PE NORMAL"], "standard": "Encounter for general adult medical examination without abnormal findings", "code": "Z00.00", "type": "exact", "organ": "Other", "note": "" },
            { "id": "Z00.01", "keywords": ["HEALTH EXAM ABNORMAL", "CHECK-UP ABNORMAL", "健康檢查異常"], "standard": "Encounter for general adult medical examination with abnormal findings", "code": "Z00.01", "type": "exact", "organ": "Other", "note": "Z00.1 為兒童健檢，成人請用 Z00.01" },
            { "id": "Z20.89", "keywords": ["CHECK-UP", "CONTACT CHECK", "接觸檢查", "EXPOSURE TO COMMUNICABLE DISEASE"], "standard": "Contact with and (suspected) exposure to other communicable diseases", "code": "Z20.89", "type": "exact", "organ": "Infectious", "note": "" },
            { "id": "G47.00", "keywords": ["INSOMNIA", "失眠", "SLEEP DISORDER"], "standard": "Insomnia, unspecified", "code": "G47.00", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "R00.2", "keywords": ["PALPITATION", "心悸", "HEART BEATING FAST"], "standard": "Palpitations", "code": "R00.2", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "R03.0", "keywords": ["ELEVATED BLOOD PRESSURE", "BP HIGH", "血壓高", "P.H.T."], "standard": "Elevated blood-pressure reading, without diagnosis of hypertension", "code": "R03.0", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "R73.9", "keywords": ["HYPERGLYCEMIA", "HIGH SUGAR", "高血糖"], "standard": "Hyperglycemia, unspecified", "code": "R73.9", "type": "exact", "organ": "Endocrine", "note": "若為糖尿病患者請使用 E11.65" },
            { "id": "Z11.1", "keywords": ["TB SCREEN", "TB SCREENING", "肺結核篩檢"], "standard": "Encounter for screening for respiratory tuberculosis", "code": "Z11.1", "type": "exact", "organ": "Infectious", "note": "" },
            { "id": "A18.89", "keywords": ["OTHER TB", "EXTRA-PULMONARY TB", "肺外結核"], "standard": "Tuberculosis of other specified organs", "code": "A18.89", "type": "broad", "organ": "Infectious", "note": "" },
            { "id": "Z86.11", "keywords": ["OLD TB", "HISTORY OF TB", "陳舊性肺結核"], "standard": "Personal history of tuberculosis", "code": "Z86.11", "type": "exact", "organ": "Infectious", "note": "" },
            { "id": "R76.11", "keywords": ["LTBI", "LATENT TB", "結核潛伏", "PPD POSITIVE", "IGRA POSITIVE"], "standard": "Nonspecific reaction to tuberculin skin test", "code": "R76.11", "type": "exact", "organ": "Infectious", "note": "" },
            { "id": "M79.10", "keywords": ["MYALGIA", "MUSCLE PAIN", "肌肉痛"], "standard": "Myalgia, unspecified site", "code": "M79.10", "type": "exact", "organ": "Other", "note": "" },
            { "id": "M94.0", "keywords": ["COSTOCHONDRITIS", "TIETZE SYNDROME", "肋軟骨炎", "CHEST WALL PAIN"], "standard": "Chondrocostal junction syndrome [Tietze]", "code": "M94.0", "type": "exact", "organ": "Other", "note": "" },
            { "id": "M54.30", "keywords": ["LBP", "SCIATICA", "坐骨神經痛", "LUMBAGO"], "standard": "Sciatica, unspecified side", "code": "M54.30", "type": "exact", "organ": "Neurological", "note": "M54.5 (LBP) 已停用，若為坐骨神經痛請用 M54.3-" },
            { "id": "R51.9", "keywords": ["HEADACHE", "頭痛", "CEPHALALGIA"], "standard": "Headache, unspecified", "code": "R51.9", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "J30.9", "keywords": ["ALLERGIC RHINITIS", "過敏性鼻炎", "HAY FEVER"], "standard": "Allergic rhinitis, unspecified", "code": "J30.9", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J01.90", "keywords": ["SINUSITIS", "ACUTE SINUSITIS", "鼻竇炎"], "standard": "Acute sinusitis, unspecified", "code": "J01.90", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "R09.82", "keywords": ["POST-NASAL DRIP", "PND", "鼻涕倒流"], "standard": "Postnasal drip", "code": "R09.82", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J06.9", "keywords": ["URI", "UPPER RESPIRATORY INFECTION", "上呼吸道感染", "COMMON COLD"], "standard": "Acute upper respiratory infection, unspecified", "code": "J06.9", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J04.0", "keywords": ["ACUTE LARYNGITIS", "LARYNGITIS", "喉炎", "HOARSENESS"], "standard": "Acute laryngitis", "code": "J04.0", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J03.90", "keywords": ["ACUTE TONSILITIS", "TONSILLITIS", "扁桃腺炎"], "standard": "Acute tonsillitis, unspecified", "code": "J03.90", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "R07.9", "keywords": ["CHEST PAIN", "胸痛", "CHEST TIGHTNESS"], "standard": "Chest pain, unspecified", "code": "R07.9", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "R06.00", "keywords": ["DYSPNEA", "SHORTNESS OF BREATH", "SOB", "呼吸困難"], "standard": "Dyspnea, unspecified", "code": "R06.00", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J36", "keywords": ["PERITONSILLAR ABSCESS", "QUINSY", "扁桃腺周圍膿瘍"], "standard": "Peritonsillar abscess", "code": "J36", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J39.3", "keywords": ["HYPERSENSITIVE AIRWAY", "AIRWAY HYPERSENSITIVITY", "氣道敏感"], "standard": "Upper respiratory tract hypersensitivity reaction, site unspecified", "code": "J39.3", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J20.9", "keywords": ["ACUTE BRONCHITIS", "急性支氣管炎"], "standard": "Acute bronchitis, unspecified", "code": "J20.9", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J21.9", "keywords": ["ACUTE BRONCHIOLITIS", "細支氣管炎"], "standard": "Acute bronchiolitis, unspecified", "code": "J21.9", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "R93.89", "keywords": ["ABNORMAL FINDING ON CXR", "CXR ABNORMAL", "影像異常"], "standard": "Abnormal findings on diagnostic imaging of other specified body structures", "code": "R93.89", "type": "exact", "organ": "Other", "note": "R91.8 為肺部特異性影像異常" },
            { "id": "H10.3", "keywords": ["ACUTE CONJUNCTIVITIS", "PINK EYE", "急性結膜炎"], "standard": "Unspecified acute conjunctivitis", "code": "H10.3", "type": "exact", "organ": "Other", "note": "" },
            { "id": "L50.9", "keywords": ["URTICARIA", "HIVES", "蕁麻疹"], "standard": "Urticaria, unspecified", "code": "L50.9", "type": "exact", "organ": "Other", "note": "" },
            { "id": "L30.9", "keywords": ["DERMATITIS", "ECZEMA", "皮膚炎", "濕疹"], "standard": "Dermatitis, unspecified", "code": "L30.9", "type": "broad", "organ": "Other", "note": "若為接觸性皮膚炎請用 L23-L25" },
            { "id": "L03.90", "keywords": ["CELLULITIS", "蜂窩性組織炎"], "standard": "Cellulitis, unspecified", "code": "L03.90", "type": "broad", "organ": "Infectious", "note": "建議指定感染部位以獲得更精確代碼 (如 L03.11 下肢)" },
            { "id": "L02.93", "keywords": ["CARBUNCLE", "癰"], "standard": "Carbuncle, unspecified", "code": "L02.93", "type": "exact", "organ": "Infectious", "note": "" },
            { "id": "L02.92", "keywords": ["FURUNCLE", "BOIL", "癤"], "standard": "Furuncle, unspecified", "code": "L02.92", "type": "exact", "organ": "Infectious", "note": "" },
            { "id": "B02.9", "keywords": ["ZOSTER", "HERPES ZOSTER", "SHINGLES", "帶狀疱疹", "皮蛇"], "standard": "Zoster without complications", "code": "B02.9", "type": "exact", "organ": "Infectious", "note": "" },
            { "id": "M47.9", "keywords": ["SPONDYLOSIS", "脊椎退化", "脊椎病"], "standard": "Spondylosis, unspecified", "code": "M47.9", "type": "broad", "organ": "Other", "note": "建議指定部位 (Cervical M47.812, Lumbar M47.816)" },
            { "id": "M48.0", "keywords": ["SPINAL STENOSIS", "HIVD", "脊椎狹窄"], "standard": "Spinal stenosis, site unspecified", "code": "M48.0", "type": "broad", "organ": "Other", "note": "M48.06: Lumbar region, M48.02: Cervical region" },
            { "id": "M54.50", "keywords": ["LOWER BACK PAIN", "LBP", "LUMBAGO", "下背痛", "腰痛"], "standard": "Low back pain, unspecified", "code": "M54.50", "type": "exact", "organ": "Other", "note": "M54.5 已停用，請使用 M54.50 (Unspecified) 或 M54.51 (Vertebrogenic)" },
            { "id": "Z89.511", "keywords": ["RIGHT BK AMPUTATION", "RIGHT BKA", "右膝下截肢"], "standard": "Acquired absence of right leg below knee", "code": "Z89.511", "type": "exact", "organ": "Other", "note": "" },
            { "id": "Z89.611", "keywords": ["RIGHT AK AMPUTATION", "RIGHT AKA", "右膝上截肢"], "standard": "Acquired absence of right leg above knee", "code": "Z89.611", "type": "exact", "organ": "Other", "note": "" },
            { "id": "Z89.512", "keywords": ["LEFT BK AMPUTATION", "LEFT BKA", "左膝下截肢"], "standard": "Acquired absence of left leg below knee", "code": "Z89.512", "type": "exact", "organ": "Other", "note": "" },
            { "id": "Z89.612", "keywords": ["LEFT AK AMPUTATION", "LEFT AKA", "左膝上截肢"], "standard": "Acquired absence of left leg above knee", "code": "Z89.612", "type": "exact", "organ": "Other", "note": "" },
            { "id": "C34.92", "keywords": ["LEFT LUNG CANCER", "LEFT LUNG CA", "MALIGNANT NEOPLASM OF LEFT LUNG", "左肺癌"], "standard": "Malignant neoplasm of unspecified part of left bronchus or lung", "code": "C34.92", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J91.0", "keywords": ["MALIGNANT PLEURAL EFFUSION", "MPE", "惡性肋膜積水"], "standard": "Malignant pleural effusion", "code": "J91.0", "type": "exact", "organ": "Respiratory", "note": "需搭配原發腫瘤代碼 (Code first underlying neoplasm)" },
            { "id": "C96.9", "keywords": ["LYMPHOMA", "LEUKEMIA", "LYMPHOID MALIGNANCY", "淋巴癌", "白血病"], "standard": "Malignant neoplasm of lymphoid, hematopoietic and related tissue, unspecified", "code": "C96.9", "type": "broad", "organ": "Other", "note": "建議使用更特定的代碼 (如 C81-C96 系列)" },
            { "id": "C37", "keywords": ["MALIGNANT THYMOMA", "THYMOMA", "惡性胸腺瘤", "胸腺瘤"], "standard": "Malignant neoplasm of thymus", "code": "C37", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "D50.9", "keywords": ["IDA", "IRON DEFICIENCY ANEMIA", "缺鐵性貧血"], "standard": "Iron deficiency anemia, unspecified", "code": "D50.9", "type": "exact", "organ": "Other", "note": "" },
            { "id": "D69.6", "keywords": ["THROMBOCYTOPENIA", "LOW PLATELET", "血小板低下", "血小板減少"], "standard": "Thrombocytopenia, unspecified", "code": "D69.6", "type": "exact", "organ": "Other", "note": "" },
            { "id": "D75.839", "keywords": ["THROMBOCYTOSIS", "HIGH PLATELET", "血小板過高", "血小板增多"], "standard": "Thrombocytosis, unspecified", "code": "D75.839", "type": "exact", "organ": "Other", "note": "" },
            { "id": "D72.819", "keywords": ["LEUKOPENIA", "LOW WBC", "DECREASED WBC", "白血球低下"], "standard": "Decreased white blood cell count, unspecified", "code": "D72.819", "type": "exact", "organ": "Other", "note": "" },
            { "id": "R97.0", "keywords": ["ELEVATED CEA", "CEA HIGH", "CEA升高", "CEA"], "standard": "Elevated carcinoembryonic antigen [CEA]", "code": "R97.0", "type": "exact", "organ": "Other", "note": "" },
            { "id": "R97.1", "keywords": ["ELEVATED CA-125", "CA-125 HIGH", "CA125升高", "CA-125"], "standard": "Elevated cancer antigen 125 [CA 125]", "code": "R97.1", "type": "exact", "organ": "Other", "note": "" },
            { "id": "R97.20", "keywords": ["ELEVATED PSA", "PSA HIGH", "PSA升高", "PSA"], "standard": "Elevated prostate specific antigen [PSA]", "code": "R97.20", "type": "exact", "organ": "Other", "note": "" },
            { "id": "R97.8", "keywords": ["ABNORMAL TUMOR MARKER", "其他腫瘤指數異常", "TUMOR MARKER ELEVATED"], "standard": "Other abnormal tumor markers", "code": "R97.8", "type": "broad", "organ": "Other", "note": "R97.20: PSA, R97.0: CEA, R97.1: CA-125, R97.8: CA19-9, AFP etc." },
            { "id": "R91.1", "keywords": ["SOLITARY LUNG NODULE", "SPN", "單一肺結節", "LUNG NODULE"], "standard": "Solitary pulmonary nodule", "code": "R91.1", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "R91.8", "keywords": ["ABNORMAL CHEST IMAGE", "LUNG FIELD ABNORMALITY", "CXR ABNORMAL", "肺部影像異常"], "standard": "Other nonspecific abnormal finding of lung field", "code": "R91.8", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "D14.30", "keywords": ["BENIGN LUNG TUMOR", "BENIGN LUNG NEOPLASM", "良性肺腫瘤"], "standard": "Benign neoplasm of unspecified bronchus and lung", "code": "D14.30", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "I46.9", "keywords": ["CARDIAC ARREST", "IHCA", "OHCA", "心跳停止"], "standard": "Cardiac arrest, cause unspecified", "code": "I46.9", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "J80", "keywords": ["ARDS", "ACUTE RESPIRATORY DISTRESS SYNDROME", "急性呼吸窘迫症候群"], "standard": "Acute respiratory distress syndrome", "code": "J80", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J81.0", "keywords": ["LUNG EDEMA", "PULMONARY EDEMA", "急性肺水腫"], "standard": "Acute pulmonary edema", "code": "J81.0", "type": "exact", "organ": "Respiratory", "note": "J81.1: Chronic pulmonary edema" },
            { "id": "R57.9", "keywords": ["SHOCK", "休克"], "standard": "Shock, unspecified", "code": "R57.9", "type": "broad", "organ": "Other", "note": "若已知原因請使用特定代碼 (如 R57.1 低血容, R57.0 心因性)" },
            { "id": "R78.81", "keywords": ["BACTERIEMIA", "BACTEREMIA", "菌血症"], "standard": "Bacteremia", "code": "R78.81", "type": "exact", "organ": "Infectious", "note": "若已進展為 Sepsis 應優先考慮 A41.9" },
            { "id": "R50.81", "keywords": ["FEVER", "PYREXIA", "發燒"], "standard": "Fever presenting with conditions classified elsewhere", "code": "R50.81", "type": "exact", "organ": "Infectious", "note": "R50.9: Fever, unspecified" },
            { "id": "Z93.0", "keywords": ["TRACHEOSTOMY", "ON TRACHEOSTOMY TUBE", "TRACHEOSTOMY STATUS", "氣切"], "standard": "Tracheostomy status", "code": "Z93.0", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "E11.21", "keywords": ["TYPE 2 DM WITH CKD", "DM NEPHROPATHY", "DIABETIC NEPHROPATHY", "糖尿病腎病變"], "standard": "Type 2 diabetes mellitus with diabetic nephropathy", "code": "E11.21", "type": "exact", "organ": "Endocrine", "note": "" },
            { "id": "E11.69", "keywords": ["DM WITH DKA", "DKA", "DIABETIC KETOACIDOSIS"], "standard": "Type 2 diabetes mellitus with other specified complication", "code": "E11.69", "type": "broad", "organ": "Endocrine", "note": "注意：DKA 標準碼通常為 E11.10 (w/o coma) 或 E11.11 (w/ coma)，E11.69 為其他併發症。" },
            { "id": "E11.42", "keywords": ["DM POLYNEUROPATHY", "DIABETIC POLYNEUROPATHY", "糖尿病多發性神經病變"], "standard": "Type 2 diabetes mellitus with diabetic polyneuropathy", "code": "E11.42", "type": "exact", "organ": "Endocrine", "note": "" },
            { "id": "E11.621", "keywords": ["DM FOOT", "DIABETIC FOOT", "FOOT ULCER", "糖尿病足"], "standard": "Type 2 diabetes mellitus with foot ulcer", "code": "E11.621", "type": "exact", "organ": "Endocrine", "note": "建議加註潰瘍部位 (L97.-)" },
            { "id": "E13.9", "keywords": ["OTHER DM", "OTHER DIABETES", "其他糖尿病"], "standard": "Other specified diabetes mellitus without complications", "code": "E13.9", "type": "broad", "organ": "Endocrine", "note": "" },
            { "id": "E07.9", "keywords": ["THYROID DISORDER", "THYROID DISEASE", "甲狀腺疾病"], "standard": "Disorder of thyroid, unspecified", "code": "E07.9", "type": "broad", "organ": "Endocrine", "note": "" },
            { "id": "E24.9", "keywords": ["CUSHING SYNDROME", "CUSHING'S SYNDROME", "庫欣氏症候群"], "standard": "Cushing's syndrome, unspecified", "code": "E24.9", "type": "exact", "organ": "Endocrine", "note": "" },
            { "id": "E27.40", "keywords": ["ADRENAL INSUFFICIENCY", "ADRENAL FAILURE", "腎上腺功能不全"], "standard": "Unspecified adrenocortical insufficiency", "code": "E27.40", "type": "exact", "organ": "Endocrine", "note": "" },
            { "id": "E78.5", "keywords": ["HYPERLIPIDEMIA", "LIPID DISORDER", "高脂血症"], "standard": "Hyperlipidemia, unspecified", "code": "E78.5", "type": "broad", "organ": "Endocrine", "note": "E78.2 為混合型高血脂 (Mixed)" },
            { "id": "E79.0", "keywords": ["HYPERURICEMIA", "HIGH URIC ACID", "高尿酸血症"], "standard": "Hyperuricaemia without signs of inflammatory arthritis and tophaceous disease", "code": "E79.0", "type": "exact", "organ": "Endocrine", "note": "" },
            { "id": "M10.9", "keywords": ["GOUT", "GOUTY ARTHRITIS", "痛風"], "standard": "Gout, unspecified", "code": "M10.9", "type": "broad", "organ": "Endocrine", "note": "" },
            { "id": "M1A.9XX1", "keywords": ["GOUT WITH TOPHI", "CHRONIC GOUT", "TOPHI", "痛風石"], "standard": "Chronic gout, unspecified, with tophus (tophi)", "code": "M1A.9XX1", "type": "exact", "organ": "Endocrine", "note": "" },
            { "id": "R77.0", "keywords": ["HYPOALBUMINEMIA", "LOW ALBUMIN", "ALBUMIN ABNORMALITY", "低白蛋白"], "standard": "Abnormality of albumin", "code": "R77.0", "type": "exact", "organ": "Other", "note": "" },
            { "id": "C50.919", "keywords": ["BREAST CANCER", "FEMALE BREAST CA", "乳癌"], "standard": "Malignant neoplasm of unspecified site of unspecified female breast", "code": "C50.919", "type": "exact", "organ": "Other", "note": "" },
            { "id": "C18.9", "keywords": ["COLON CANCER", "COLON CA", "大腸癌", "結腸癌"], "standard": "Malignant neoplasm of colon, unspecified", "code": "C18.9", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "C22.0", "keywords": ["HCC", "HEPATOCELLULAR CARCINOMA", "LIVER CANCER", "肝癌"], "standard": "Liver cell carcinoma", "code": "C22.0", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "C67.9", "keywords": ["BLADDER CANCER", "URINARY BLADDER CANCER", "膀胱癌"], "standard": "Malignant neoplasm of bladder, unspecified", "code": "C67.9", "type": "exact", "organ": "Renal", "note": "" },
            { "id": "C78.00", "keywords": ["LUNG METASTASIS", "META LUNG", "肺轉移"], "standard": "Secondary malignant neoplasm of unspecified lung", "code": "C78.00", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "C79.51", "keywords": ["BONE METASTASIS", "META BONE", "骨轉移"], "standard": "Secondary malignant neoplasm of bone", "code": "C79.51", "type": "exact", "organ": "Other", "note": "" },
            { "id": "C79.31", "keywords": ["BRAIN METASTASIS", "META BRAIN", "腦轉移"], "standard": "Secondary malignant neoplasm of brain", "code": "C79.31", "type": "exact", "organ": "Neurological", "note": "" },
            { "id": "R59.0", "keywords": ["ENLARGED LN", "LYMPHADENOPATHY", "LAP", "淋巴結腫大"], "standard": "Localized enlarged lymph nodes", "code": "R59.0", "type": "exact", "organ": "Other", "note": "" },
            { "id": "I28.8", "keywords": ["HILAR VASCULAR ENGORGEMENT", "肺門血管充血"], "standard": "Other diseases of pulmonary vessels", "code": "I28.8", "type": "exact", "organ": "Cardiovascular", "note": "" },
            { "id": "urosepsis", "keywords": ["UROSEPSIS", "尿路敗血症"], "standard": "Sepsis due to urinary tract infection", "code": "A41.9", "type": "context", "organ": "Infectious", "note": "此為敗血症代碼，建議加註感染源 N39.0 (UTI)" },
            { "id": "1765282770365", "keywords": ["NKHS", "HHS"], "standard": "Type 2 diabetes mellitus with hyperosmolarity with coma (used if the patient has altered mental status/coma)", "code": "E11.01", "type": "exact", "organ": "Endocrine", "note": "E11.00: Type 2 diabetes mellitus with hyperosmolarity without coma (未昏迷)" },
            { "id": "1765280392308", "keywords": ["Alcoholic gastritis with bleeding", "酒精性胃炎。"], "standard": "Alcoholic gastritis with bleeding", "code": "K29.21", "type": "exact", "organ": "Other", "note": "" },
            { "id": "1765280347468", "keywords": ["Acute gastric ulcer with hemorrhage", "UGI bleeding", "GU"], "standard": "Acute gastric ulcer with hemorrhage", "code": "K25.0", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "1765280261361", "keywords": ["Esophageal varices with bleeding", "EV bleeding", "食道靜脈瘤"], "standard": "Esophageal varices with bleeding", "code": "I85.01", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "1765279506333", "keywords": ["體液缺乏"], "standard": "Volume depletion, unspecified", "code": "E86.9", "type": "exact", "organ": "Endocrine", "note": "E86.0: Dehydration、E86.1: Hypovolemia. " },
            { "id": "1765278250857", "keywords": ["COVID-19", "新冠病毒"], "standard": "COVID-19, virus identified", "code": "U07.1", "type": "exact", "organ": "Respiratory", "note": "U07.2 COVID-19 is diagnosed clinically（臨床診斷）" },
            { "id": "1765278129792", "keywords": ["Mycoplasma", "黴漿菌", "急性支氣管炎"], "standard": "Acute bronchitis due to Mycoplasma pneumoniae", "code": "J20.0", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "1765277774085", "keywords": ["Acute pharyngitis", "sorethroat", "喉嚨痛"], "standard": "Acute pharyngitis, unspecified", "code": "J02.9", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "1765277626457", "keywords": ["來院開立其他證明書", "certification"], "standard": "For certification", "code": "Z02.79", "type": "exact", "organ": "Other", "note": "" },
            { "id": "1765276827042", "keywords": ["支氣管擴張症併(急性)發作", "bronchiectasis"], "standard": "Bronchiectasis with acute exacerbation", "code": "J47.1", "type": "exact", "organ": "Respiratory", "note": "" },
            { "id": "J15.0", "organ": "Respiratory", "keywords": ["J15.0", "KP PNEUMONIA", "KLEBSIELLA", "克雷白", "克雷白氏肺炎"], "standard": "Pneumonia due to Klebsiella pneumoniae", "code": "J15.0", "type": "exact" },
            { "id": "J15.1", "organ": "Respiratory", "keywords": ["J15.1", "PSEUDOMONAS", "綠膿桿菌"], "standard": "Pneumonia due to Pseudomonas", "code": "J15.1", "type": "exact" },
            { "id": "J69.0", "organ": "Respiratory", "keywords": ["J69.0", "ASPIRATION PNEUMONIA", "吸入性肺炎", "嗆入"], "standard": "Pneumonitis due to inhalation of food and vomit", "code": "J69.0", "type": "exact", "note": "常見於中風或吞嚥困難病患" },
            { "id": "J18.0", "organ": "Respiratory", "keywords": ["J18.0", "BRONCHOPNEUMONIA", "支氣管肺炎"], "standard": "Bronchopneumonia, unspecified organism", "code": "J18.0", "type": "exact" },
            { "id": "J18.9", "organ": "Respiratory", "keywords": ["J18.9", "PNEUMONIA", "肺炎", "PNEUMONITIS"], "standard": "Pneumonia, unspecified organism", "code": "J18.9", "type": "broad", "note": "J15.0 克雷白肺炎桿菌所致之肺炎、J15.1 綠膿桿菌所致之肺炎" },
            { "id": "J10.1", "organ": "Respiratory", "keywords": ["J10.1", "FLU CONFIRMED", "INFLUENZA A", "INFLUENZA B", "流感已確認", "流行性感冒"], "standard": "Influenza due to other identified influenza virus", "code": "J10.1", "type": "exact" },
            { "id": "J11.1", "organ": "Respiratory", "keywords": ["J11.1", "FLU", "SUSPECTED FLU", "疑似流感", "未確認流感"], "standard": "Influenza due to unidentified influenza virus", "code": "J11.1", "type": "broad" },
            { "id": "J86.9", "organ": "Respiratory", "keywords": ["J86.9", "EMPYEMA", "PYOTHORAX", "肺積膿", "膿胸"], "standard": "Pyothorax without fistula", "code": "J86.9", "type": "exact" },
            { "id": "J85.1", "organ": "Respiratory", "keywords": ["J85.1", "LUNG ABSCESS", "NECROTIZING PNEUMONIA", "肺膿瘍", "壞死性肺炎"], "standard": "Abscess of lung with pneumonia", "code": "J85.1", "type": "exact" },
            { "id": "J40", "organ": "Respiratory", "keywords": ["J40", "BRONCHITIS", "支氣管炎"], "standard": "Bronchitis, not specified as acute or chronic", "code": "J40", "type": "broad" },
            { "id": "J44.1", "organ": "Respiratory", "keywords": ["J44.1", "AECOPD", "COPD AE", "COPD WITH ACUTE EXACERBATION", "慢阻肺急性發作"], "standard": "COPD with (acute) exacerbation", "code": "J44.1", "type": "exact" },
            { "id": "J44.9", "organ": "Respiratory", "keywords": ["J44.9", "COPD", "肺阻塞", "慢性阻塞性肺病"], "standard": "Chronic obstructive pulmonary disease, unspecified", "code": "J44.9", "type": "exact" },
            { "id": "J91.8", "organ": "Respiratory", "keywords": ["J91.8", "PLEURAL EFFUSION", "PE", "肋膜積水", "胸水"], "standard": "Pleural effusion in other conditions classified elsewhere", "code": "J91.8", "type": "context", "note": "需搭配主診斷 (如心衰竭、肺炎)" },
            { "id": "J96.00", "organ": "Respiratory", "keywords": ["J96.00", "ACUTE RESPIRATORY FAILURE", "ARF", "急性呼吸衰竭", "respiratory failure"], "standard": "Acute respiratory failure, unspecified", "code": "J96.00", "type": "broad", "note": "J96.01 急性呼吸衰竭（缺氧性）、 J96.02 急性呼吸衰竭（高碳酸血症）" },
            { "id": "J96.01", "organ": "Respiratory", "keywords": ["J96.01", "HYPOXIC ARF", "TYPE 1 ARF", "缺氧性呼吸衰竭"], "standard": "Acute respiratory failure with hypoxia", "code": "J96.01", "type": "exact" },
            { "id": "J96.02", "organ": "Respiratory", "keywords": ["J96.02", "HYPERCAPNIC ARF", "TYPE 2 ARF", "高碳酸血症呼吸衰竭", "CO2 RETENTION"], "standard": "Acute respiratory failure with hypercapnia", "code": "J96.02", "type": "exact" },
            { "id": "J96.10", "organ": "Respiratory", "keywords": ["J96.10", "CHRONIC RESPIRATORY FAILURE", "CRF RESP", "慢性呼吸衰竭"], "standard": "Chronic respiratory failure, unspecified", "code": "J96.10", "type": "broad", "note": "J96.11 慢性呼吸衰竭（缺氧性）、 J96.12 慢性呼吸衰竭（高碳酸血症）" },
            { "id": "Z99.11", "organ": "Respiratory", "keywords": ["Z99.11", "VENTILATOR DEPENDENCE", "RCD", "呼吸器依賴", "呼吸器", "MV dependent"], "standard": "Dependence on respirator [ventilator] status", "code": "Z99.11", "type": "exact", "note": "" },
            { "id": "A15.0", "organ": "Respiratory", "keywords": ["A15.0", "TB", "TUBERCULOSIS", "肺結核", "PULMONARY TB"], "standard": "Tuberculosis of lung", "code": "A15.0", "type": "exact" },
            { "id": "A15.6", "organ": "Respiratory", "keywords": ["A15.6", "TB PLEURISY", "結核性肋膜炎"], "standard": "Tuberculous pleurisy", "code": "A15.6", "type": "exact" },
            { "id": "Z20.1", "organ": "Respiratory", "keywords": ["Z20.1", "TB CONTACT", "TB EXPOSURE", "接觸結核病"], "standard": "Contact with and (suspected) exposure to tuberculosis", "code": "Z20.1", "type": "exact" },
            { "id": "C34.1", "organ": "Respiratory", "keywords": ["肺癌", "肺惡性腫瘤", "lung cancer", "Adenocarcinoma", "SCLC", "NSCLC"], "standard": "Malignant neoplasm of Bronchus or lung, unspecified ", "code": "C34.9", "type": "exact", "note": "C34.0: Main bronchus、 C34.1: Upper lobe, bronchus or lung 、C34.2: Middle lobe, bronchus or lung、C34.3: Lower lobe, bronchus or lung (e.g., C34.31 for right, C34.32 for left)" },
            { "id": "R04.2", "organ": "Respiratory", "keywords": ["R04.2", "HEMOPTYSIS", "咳血"], "standard": "Hemoptysis", "code": "R04.2", "type": "exact" },
            { "id": "I10", "organ": "Cardiovascular", "keywords": ["I10", "HTN", "HYPERTENSION", "高血壓", "H/T"], "standard": "Essential (primary) hypertension", "code": "I10", "type": "exact" },
            { "id": "I11.9", "organ": "Cardiovascular", "keywords": ["I11.9", "HCVD", "高血壓性心臟病", "hypertensive cardiovascular disease"], "standard": "Hypertensive heart disease without heart failure", "code": "I11.9", "type": "broad", "note": "" },
            { "id": "I11.0", "organ": "Cardiovascular", "keywords": ["I11.0", "HCVD WITH CHF", "高血壓心臟病合併心衰竭", "hypertensive cardiovascular disease"], "standard": "Hypertensive heart disease with heart failure", "code": "I11.0", "type": "exact", "note": "" },
            { "id": "I25.9", "organ": "Cardiovascular", "keywords": ["I25.9", "IHD", "CAD", "ISCHEMIC HEART DISEASE", "冠心病", "缺血性心臟病"], "standard": "Chronic ischemic heart disease, unspecified", "code": "I25.9", "type": "broad" },
            { "id": "I48.0", "organ": "Cardiovascular", "keywords": ["I48.0", "PAF", "PAROXYSMAL AF", "陣發性心房顫動", "Afib", "fibrillation"], "standard": "Paroxysmal atrial fibrillation", "code": "I48.0", "type": "exact", "note": "" },
            { "id": "I48.2", "organ": "Cardiovascular", "keywords": ["I48.2", "CHRONIC AF", "PERMANENT AF", "慢性心房顫動", "Afib", "fibrillation"], "standard": "Chronic atrial fibrillation", "code": "I48.2", "type": "exact", "note": "" },
            { "id": "I48.91", "organ": "Cardiovascular", "keywords": ["I48.91", "AF", "AFIB", "ATRIAL FIBRILLATION", "心房顫動"], "standard": "Unspecified atrial fibrillation", "code": "I48.91", "type": "broad" },
            { "id": "I50.2", "organ": "Cardiovascular", "keywords": ["I50.2", "SYSTOLIC CHF", "HFrEF", "收縮性心衰竭", "systolic heart failure"], "standard": "Systolic (congestive) heart failure", "code": "I50.2", "type": "broad", "note": "需細分 Acute (I50.21), Chronic (I50.22) 或 Acute on Chronic (I50.23)" },
            { "id": "I50.3", "organ": "Cardiovascular", "keywords": ["I50.3", "DIASTOLIC CHF", "HFpEF", "舒張性心衰竭", "diastolic heart failure"], "standard": "Diastolic (congestive) heart failure", "code": "I50.3", "type": "broad", "note": "" },
            { "id": "I50.43", "organ": "Cardiovascular", "keywords": ["I50.43", "ACUTE ON CHRONIC CHF", "心衰竭急性發作", "acute on chronic heart failure"], "standard": "Acute on chronic combined systolic and diastolic heart failure", "code": "I50.43", "type": "exact", "note": "" },
            { "id": "I50.9", "organ": "Cardiovascular", "keywords": ["I50.9", "CHF", "HEART FAILURE", "心臟衰竭"], "standard": "Heart failure, unspecified", "code": "I50.9", "type": "broad" },
            { "id": "I63.9", "organ": "Neurological", "keywords": ["I63", "CVA", "STROKE", "ACUTE STROKE", "腦中風", "急性腦中風", "INFARCTION"], "standard": "Cerebral infarction, unspecified", "code": "I63.9", "type": "broad", "note": "I63 為急性梗塞，請儘量確認血管位置：I63.3: Cerebral infarction due to thrombosis of cerebral arteries (e.g., middle cerebral artery)." },
            { "id": "I69.30", "organ": "Neurological", "keywords": ["I69", "OLD CVA", "PRIOR STROKE", "陳舊性中風", "中風後遺症"], "standard": "Sequelae of cerebral infarction", "code": "I69.30", "type": "context" },
            { "id": "I69.959", "organ": "Neurological", "keywords": ["I69.959", "HEMIPLEGIA", "偏癱", "半身不遂"], "standard": "Hemiplegia following unspecified cerebrovascular disease", "code": "I69.959", "type": "exact" },
            { "id": "A41.9", "organ": "Infectious", "keywords": ["A41.9", "SEPSIS", "敗血症"], "standard": "Sepsis, unspecified organism", "code": "A41.9", "type": "broad", "note": "若有 organ dysfunction 請考慮 Severe Sepsis" },
            { "id": "R65.20", "organ": "Infectious", "keywords": ["R65.20", "SEVERE SEPSIS", "嚴重敗血症"], "standard": "Severe sepsis without septic shock", "code": "R65.20", "type": "exact" },
            { "id": "R65.21", "organ": "Infectious", "keywords": ["R65.21", "SEPTIC SHOCK", "敗血性休克"], "standard": "Severe sepsis with septic shock", "code": "R65.21", "type": "exact" },
            { "id": "N39.0", "organ": "Renal", "keywords": ["N39.0", "UTI", "URINARY TRACT INFECTION", "泌尿道感染"], "standard": "Urinary tract infection, site not specified", "code": "N39.0", "type": "exact" },
            { "id": "E11.9", "organ": "Endocrine", "keywords": ["E11.9", "DM", "DIABETES", "糖尿病", "TYPE 2 DM"], "standard": "Type 2 diabetes mellitus without complications", "code": "E11.9", "type": "broad" },
            { "id": "E11.65", "organ": "Endocrine", "keywords": ["E11.65", "DM HIGH SUGAR", "HYPERGLYCEMIA", "高血糖"], "standard": "Type 2 diabetes mellitus with hyperglycemia", "code": "E11.65", "type": "exact" },
            { "id": "E78.2", "organ": "Endocrine", "keywords": ["E78.2", "HYPERLIPIDEMIA", "MIXED HYPERLIPIDEMIA", "高血脂", "混合型高血脂"], "standard": "Mixed hyperlipidemia", "code": "E78.2", "type": "exact" },
            { "id": "E86.0", "organ": "Endocrine", "keywords": ["E86.0", "DEHYDRATION", "脫水", "prerenal azotemia"], "standard": "Dehydration", "code": "E86.0", "type": "exact", "note": "" },
            { "id": "E86.1", "organ": "Endocrine", "keywords": ["E86.1", "HYPOVOLEMIA", "低血容量"], "standard": "Hypovolemia （decreased blood volume with electrolyte loss）", "code": "E86.1", "type": "exact", "note": "" },
            { "id": "E87.1", "organ": "Endocrine", "keywords": ["E87.1", "HYPONATREMIA", "LOW SODIUM", "低血鈉"], "standard": "Hypo-osmolality and hyponatremia", "code": "E87.1", "type": "exact" },
            { "id": "E87.5", "organ": "Endocrine", "keywords": ["E87.5", "HYPERKALEMIA", "HIGH K", "高血鉀"], "standard": "Hyperkalemia", "code": "E87.5", "type": "exact" },
            { "id": "E87.6", "organ": "Endocrine", "keywords": ["E87.6", "HYPOKALEMIA", "LOW K", "低血鉀"], "standard": "Hypokalemia", "code": "E87.6", "type": "exact" },
            { "id": "N17.9", "organ": "Renal", "keywords": ["N17.9", "AKI", "ACUTE RENAL FAILURE", "急性腎衰竭"], "standard": "Acute kidney failure, unspecified", "code": "N17.9", "type": "exact" },
            { "id": "Z99.2", "organ": "Renal", "keywords": ["Z99.2", "ESRD", "DIALYSIS", "洗腎", "血液透析"], "standard": "Dependence on renal dialysis", "code": "Z99.2", "type": "exact" },
            { "id": "N40.0", "organ": "Renal", "keywords": ["N40.0", "BPH", "攝護腺肥大"], "standard": "Benign prostatic hyperplasia without lower urinary tract symptoms", "code": "N40.0", "type": "exact" },
            { "id": "N40.1", "organ": "Renal", "keywords": ["N40.1", "SYMPTOMATIC BPH", "攝護腺肥大合併症狀", "BPH"], "standard": "Benign prostatic hyperplasia with lower urinary tract symptoms", "code": "N40.1", "type": "exact", "note": "" },
            { "id": "K21.0", "organ": "Digestive", "keywords": ["K21.0", "GERD", "REFLUX ESOPHAGITIS", "逆流性食道炎", "胃食道逆流合併食道炎"], "standard": "Gastro-esophageal reflux disease with esophagitis", "code": "K21.0", "type": "exact" },
            { "id": "L89", "keywords": ["L89", "PRESSURE SORE", "BED SORE", "褥瘡", "壓瘡"], "standard": "Pressure ulcer", "code": "L89.90", "type": "broad", "organ": "Other", "note": "請指定部位與分級 (Stage 1-4)" },
            { "id": "R42", "keywords": ["R42", "DIZZINESS", "VERTIGO", "頭暈", "眩暈"], "standard": "Dizziness and giddiness", "code": "R42", "type": "exact", "organ": "Neurological" },
            { "id": "T88.6", "keywords": ["ANAPHYLACTIC SHOCK DUE TO DRUG", "DRUG ANAPHYLAXIS", "藥物過敏休克"], "standard": "Anaphylactic reaction due to adverse effect of correct drug or medicament properly administered", "code": "T88.6", "type": "exact", "organ": "Other", "note": "" },
            { "id": "T88.7", "keywords": ["UNSPECIFIED ADVERSE EFFECT OF DRUG", "DRUG SIDE EFFECT", "藥物副作用"], "standard": "Unspecified adverse effect of drug or medicament", "code": "T88.7", "type": "broad", "organ": "Other", "note": "" },
            { "id": "M32.10", "keywords": ["SLE", "SYSTEMIC LUPUS ERYTHEMATOSUS", "全身性紅斑性狼瘡"], "standard": "Systemic lupus erythematosus, organ or system involvement unspecified", "code": "M32.10", "type": "broad", "organ": "Other", "note": "" },
            { "id": "M06.9", "keywords": ["RA", "RHEUMATOID ARTHRITIS", "類風濕性關節炎"], "standard": "Rheumatoid arthritis, unspecified", "code": "M06.9", "type": "broad", "organ": "Other", "note": "" },
            { "id": "K52.9", "keywords": ["NON-INFECTIVE GASTROENTERITIS", "AGE", "ACUTE GASTROENTERITIS", "腸胃炎"], "standard": "Noninfective gastroenteritis and colitis, unspecified", "code": "K52.9", "type": "exact", "organ": "Digestive", "note": "臨床上常混用 AGE，若確診為感染性請改用 A09" },
            { "id": "A09", "keywords": ["INFECTIOUS GASTROENTERITIS", "INFECTIOUS COLITIS", "感染性腸胃炎"], "standard": "Infectious gastroenteritis and colitis, unspecified", "code": "A09", "type": "exact", "organ": "Digestive", "note": "" },
            { "id": "R10.9", "keywords": ["ABDOMINAL PAIN", "STOMACH ACHE", "腹痛"], "standard": "Unspecified abdominal pain", "code": "R10.9", "type": "broad", "organ": "Digestive", "note": "" },
            { "id": "K80", "keywords": ["GALL STONE", "CHOLELITHIASIS", "膽結石"], "standard": "Cholelithiasis", "code": "K80", "type": "broad", "organ": "Digestive", "note": "建議使用更精確代碼 (如 K80.20)" },
            { "id": "K80.20", "keywords": ["GALL STONE NO CHOLECYSTITIS", "GALL STONE NO OBSTRUCTION"], "standard": "Calculus of gallbladder without cholecystitis without obstruction", "code": "K80.20", "type": "exact", "organ": "Digestive", "note": "" }
        ];

        // 模擬的藥物/無關詞彙過濾清單
        const IGNORE_LIST = [
            'ASPIRIN', 'PLAVIX', 'METFORMIN', 'LASIX', 'KCL', 'N/S', 'BOKEY', 'NORVASC', 
            'LIPITOR', 'INSULIN', 'ANTIBIOTICS', 'IV', 'PO', 'BID', 'QID', 'TID', 'PRN', 
            'ADMISSION', 'DISCHARGE', 'MBD', 'OBSERVATION', 'VITALS', 'BP', 'HR', 'RR', 'BT',
            'CURRENT MEDICATIONS', 'ALLERGIES', 'PLAN', 'SOAP'
        ];

        const App = () => {
            // 隱藏的文件上傳 ref
            const fileInputRef = useRef(null);

            // Modal 和 Toast 狀態
            const [modalConfig, setModalConfig] = useState(null);
            const [toastMessage, setToastMessage] = useState(null);

            const showToast = (msg) => {
                setToastMessage(msg);
            };

            // 核心狀態：Lazy Initialization (確保優先讀取 LocalStorage)
            // 修正：增加自動去重複化 (Deduplication) 邏輯，避免 key 重複錯誤
            const [database, setDatabase] = useState(() => {
                let initialData = INITIAL_DATABASE;
                try {
                const savedDb = localStorage.getItem('icd10_custom_db');
                if (savedDb) {
                    const parsed = JSON.parse(savedDb);
                    // 如果 localStorage 有資料，先載入
                    initialData = parsed;
                }
                } catch (e) {
                console.error("Failed to load initial DB", e);
                }

                // 關鍵修正：確保 id 唯一性
                const uniqueMap = new Map();
                initialData.forEach(item => {
                if (!uniqueMap.has(item.id)) {
                    uniqueMap.set(item.id, {
                        ...item,
                        organ: item.organ || 'Other' 
                    });
                }
                });
                
                return Array.from(uniqueMap.values());
            });

            const [inputText, setInputText] = useState('');
            const [results, setResults] = useState([]);
            
            // UI 狀態
            const [activeTab, setActiveTab] = useState('coding'); 
            const [isProcessing, setIsProcessing] = useState(false);
            const [progressStep, setProgressStep] = useState(0); 

            // 排序狀態
            const [sortConfig, setSortConfig] = useState({ key: 'code', direction: 'asc' });

            // 編輯模式狀態
            const [editingId, setEditingId] = useState(null);

            // 新增/編輯規則表單
            const [newRule, setNewRule] = useState({
                code: '',
                standard: '',
                keywords: '',
                type: 'exact',
                organ: 'Other', 
                note: ''
            });

            // 自動保存：當 database 變更時，同步寫入 localStorage
            useEffect(() => {
                localStorage.setItem('icd10_custom_db', JSON.stringify(database));
            }, [database]);

            // --- 重置/備份/還原/開發者 功能區 ---

            // 智慧重置：保留使用者自訂資料，只還原內建資料
            const handleSmartResetDb = () => {
                setModalConfig({
                title: '確認重置',
                message: '確定要還原系統預設值嗎？\n不用擔心！您的「自訂規則」會被保留下來，只有內建的規則會被重置到最新版本。',
                confirmText: '執行重置',
                confirmColor: 'bg-red-600 hover:bg-red-700',
                onConfirm: () => {
                    const initialIds = new Set(INITIAL_DATABASE.map(item => item.id));
                    const customRules = database.filter(item => !initialIds.has(item.id));
                    
                    // 合併時也要注意去重複
                    const mergedDb = [...customRules, ...INITIAL_DATABASE];
                    const uniqueMap = new Map();
                    mergedDb.forEach(item => {
                        if(!uniqueMap.has(item.id)){
                            uniqueMap.set(item.id, item);
                        }
                    });

                    setDatabase(Array.from(uniqueMap.values()));
                    setModalConfig(null);
                    showToast(`重置完成！保留了 ${customRules.length} 筆自訂規則。`);
                },
                onCancel: () => setModalConfig(null)
                });
            };

            // 匯出資料庫 (Backup JSON File)
            const handleExportDb = () => {
                const dataStr = JSON.stringify(database, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `icd10_backup_${new Date().toISOString().slice(0, 10)}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showToast('資料庫備份檔 (.json) 已下載！');
            };

            // 開發者功能：匯出完整資料庫內容 (Copy to Clipboard for Code Update)
            const handleCopyForDeveloper = () => {
                // 移除 isCustom 標記，保持資料乾淨，以便貼回 INITIAL_DATABASE
                const cleanDb = database.map(({ isCustom, ...rest }) => rest);
                const jsonString = JSON.stringify(cleanDb, null, 2);
                
                navigator.clipboard.writeText(jsonString).then(() => {
                showToast('已複製完整資料庫內容！');
                });
            };

            // 匯入資料庫 (Restore)
            const handleImportClick = () => {
                fileInputRef.current.click();
            };

            const handleFileChange = (event) => {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData)) {
                    setModalConfig({
                        title: '確認匯入',
                        message: `確定要匯入 ${importedData.length} 筆規則嗎？\n這將會覆蓋您目前的資料庫。`,
                        confirmText: '匯入',
                        onConfirm: () => {
                        // 匯入時同樣進行去重複檢查
                        const uniqueMap = new Map();
                        importedData.forEach(item => {
                            if(item.id && !uniqueMap.has(item.id)){
                                uniqueMap.set(item.id, item);
                            }
                        });
                        setDatabase(Array.from(uniqueMap.values()));
                        setModalConfig(null);
                        showToast('資料庫匯入成功！');
                        },
                        onCancel: () => {
                        setModalConfig(null);
                        // reset file input
                        if(fileInputRef.current) fileInputRef.current.value = '';
                        }
                    });
                    } else {
                    showToast('匯入失敗：檔案格式不正確。');
                    }
                } catch (error) {
                    showToast('匯入失敗：無法讀取檔案。');
                    console.error(error);
                }
                };
                reader.readAsText(file);
                event.target.value = ''; // Ensure onChange fires again for same file if needed
            };

            // -------------------------

            const requestSort = (key) => {
                let direction = 'asc';
                if (sortConfig.key === key && sortConfig.direction === 'asc') {
                direction = 'desc';
                }
                setSortConfig({ key, direction });
            };

            const sortedDatabase = useMemo(() => {
                let sortableItems = [...database];
                if (sortConfig.key) {
                sortableItems.sort((a, b) => {
                    let valA = a[sortConfig.key] || '';
                    let valB = b[sortConfig.key] || '';
                    
                    if (sortConfig.key === 'organ') {
                    if (valA === 'Other') return 1;
                    if (valB === 'Other') return -1;
                    }

                    if (valA < valB) return sortConfig.direction === 'asc' ? -1 : 1;
                    if (valA > valB) return sortConfig.direction === 'asc' ? 1 : -1;
                    return 0;
                });
                }
                return sortableItems;
            }, [database, sortConfig]);

            const handleAnalyze = () => {
                if (!inputText.trim()) return;
                
                setIsProcessing(true);
                setResults([]);
                setProgressStep(1);

                setTimeout(() => {
                setProgressStep(2);
                setTimeout(() => {
                    setProgressStep(3);
                    setTimeout(() => {
                    performCoding();
                    setIsProcessing(false);
                    setProgressStep(0);
                    }, 500);
                }, 500);
                }, 500);
            };

            const performCoding = () => {
                // 增加切割符號：斜線(/), 冒號(:), 括號()
                const segments = inputText.split(/[\n,;，、。/:().?]+/).map(s => s.trim()).filter(s => s.length > 0);
                const newResults = [];
                const usedCodes = new Set();

                const processSegment = (rawSegment) => {
                const cleanSegment = rawSegment.toUpperCase();
                if (cleanSegment.length < 2) return;
                
                const isIgnored = IGNORE_LIST.some(ignore => {
                    // 如果是短縮寫 (如 PO, IV, BP)，必須全字匹配
                    if (ignore.length <= 4) {
                        const escapedIgnore = ignore.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex = new RegExp(`\\b${escapedIgnore}\\b`);
                        return regex.test(cleanSegment);
                    }
                    // 長單字則維持寬鬆匹配
                    return cleanSegment.includes(ignore);
                });

                if (isIgnored) return;

                let match = null;
                let highestRelevance = 0;

                database.forEach(entry => {
                    entry.keywords.forEach(keyword => {
                    const k = keyword.toUpperCase();
                    let isMatch = false;

                    const isEnglishKeyword = /^[A-Z0-9\s\-\.]+$/.test(k);

                    if (isEnglishKeyword) {
                        const escapedK = k.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                        const regex = new RegExp(`\\b${escapedK}\\b`);
                        isMatch = regex.test(cleanSegment);
                    } else {
                        isMatch = cleanSegment.includes(k);
                    }

                    if (isMatch) {
                        let currentScore = k.length;
                        
                        if (cleanSegment === k) {
                            currentScore += 100;
                        }

                        if (currentScore > highestRelevance) {
                        highestRelevance = currentScore;
                        match = { ...entry, original: rawSegment };
                        }
                    }
                    });
                });

                if (match) {
                    if (!usedCodes.has(match.code)) {
                    newResults.push(match);
                    usedCodes.add(match.code);
                    }
                }
                };

                segments.forEach(seg => {
                processSegment(seg);
                });

                setResults(newResults);
            };

            const handleSaveRule = () => {
                if (!newRule.code || !newRule.standard || !newRule.keywords) {
                showToast('請填寫完整資訊 (代碼、標準名稱、關鍵字)');
                return;
                }

                const keywordsArray = newRule.keywords.split(/[,，、]/).map(k => k.trim()).filter(k => k.length > 0);

                const ruleData = {
                keywords: keywordsArray,
                standard: newRule.standard,
                code: newRule.code,
                type: newRule.type,
                organ: newRule.organ,
                note: newRule.note,
                isCustom: true 
                };

                if (editingId) {
                setDatabase(prev => prev.map(item => {
                    if (item.id === editingId) {
                    return { ...item, ...ruleData };
                    }
                    return item;
                }));
                showToast('更新成功！已保存至瀏覽器。');
                handleCancelEdit();
                } else {
                const newItem = {
                    id: Date.now().toString(),
                    ...ruleData
                };
                setDatabase(prev => [newItem, ...prev]); 
                showToast('新增成功！已保存至瀏覽器。');
                setNewRule({ code: '', standard: '', keywords: '', type: 'exact', organ: 'Other', note: '' });
                }
            };

            const handleEditRule = (rule) => {
                setEditingId(rule.id);
                setNewRule({
                code: rule.code,
                standard: rule.standard,
                keywords: rule.keywords.join(', '),
                type: rule.type,
                organ: rule.organ || 'Other',
                note: rule.note || ''
                });
            };

            const handleCancelEdit = () => {
                setEditingId(null);
                setNewRule({ code: '', standard: '', keywords: '', type: 'exact', organ: 'Other', note: '' });
            };

            const handleDeleteRule = (id) => {
                setModalConfig({
                title: '刪除確認',
                message: '確定要刪除這條規則嗎？此動作無法復原。',
                confirmText: '刪除',
                confirmColor: 'bg-red-600 hover:bg-red-700',
                onConfirm: () => {
                    setDatabase(prev => prev.filter(item => item.id !== id));
                    if (editingId === id) {
                    handleCancelEdit();
                    }
                    setModalConfig(null);
                    showToast('規則已刪除');
                },
                onCancel: () => setModalConfig(null)
                });
            };

            const clearAll = () => {
                setInputText('');
                setResults([]);
                setProgressStep(0);
            };

            const copyToClipboard = () => {
                const text = results.map(r => `${r.code} - ${r.standard}`).join('\n');
                navigator.clipboard.writeText(text);
                showToast('編碼結果已複製到剪貼簿');
            };

            const getOrganColor = (organValue) => {
                const category = ORGAN_CATEGORIES.find(c => c.value === organValue);
                return category ? category.color : 'bg-slate-100 text-slate-800';
            };
            
            const getOrganLabel = (organValue) => {
                const category = ORGAN_CATEGORIES.find(c => c.value === organValue);
                return category ? category.label.split(' ')[0] : organValue; 
            };

            const SortIcon = ({ colKey }) => {
                if (sortConfig.key !== colKey) return <ArrowUpDown className="w-3 h-3 ml-1 text-slate-300" />;
                return sortConfig.direction === 'asc' 
                ? <ArrowUp className="w-3 h-3 ml-1 text-blue-600" /> 
                : <ArrowDown className="w-3 h-3 ml-1 text-blue-600" />;
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 relative">
                {/* Hidden File Input for Import */}
                <input 
                    type="file" 
                    ref={fileInputRef} 
                    onChange={handleFileChange} 
                    style={{ display: 'none' }} 
                    accept=".json"
                />

                {/* Global Modals & Toasts */}
                <ConfirmModal 
                    isOpen={!!modalConfig} 
                    {...modalConfig} 
                />
                
                {toastMessage && (
                    <Toast 
                    message={toastMessage} 
                    onClose={() => setToastMessage(null)} 
                    />
                )}

                {/* Header */}
                <header className="bg-blue-900 text-white shadow-lg sticky top-0 z-50">
                    <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                        <Stethoscope className="w-8 h-8 text-blue-300" />
                        <div>
                        <h1 className="text-xl font-bold tracking-wide">內科醫學編碼互動式平台</h1>
                        <p className="text-xs text-blue-200">ICD-10-CM Internal Medicine Coding Assistant</p>
                        </div>
                    </div>
                    
                    <div className="flex bg-blue-800 rounded-lg p-1 space-x-1">
                        <button 
                        onClick={() => setActiveTab('coding')}
                        className={`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center ${
                            activeTab === 'coding' ? 'bg-white text-blue-900 shadow-sm' : 'text-blue-200 hover:bg-blue-700'
                        }`}
                        >
                        <Search className="w-4 h-4 mr-2" />
                        臨床編碼
                        </button>
                        <button 
                        onClick={() => setActiveTab('database')}
                        className={`px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center ${
                            activeTab === 'database' ? 'bg-white text-blue-900 shadow-sm' : 'text-blue-200 hover:bg-blue-700'
                        }`}
                        >
                        <Database className="w-4 h-4 mr-2" />
                        資料庫管理
                        </button>
                    </div>
                    </div>
                </header>

                {/* Main Content */}
                <main className="max-w-7xl mx-auto px-4 py-6 h-[calc(100vh-90px)]">
                    
                    {/* VIEW 1: CODING WORKSPACE */}
                    {activeTab === 'coding' && (
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 h-full">
                        {/* Left Panel: Input */}
                        <div className="flex flex-col space-y-4 h-full">
                        <div className="bg-white rounded-xl shadow-sm border border-slate-200 flex-1 flex flex-col p-4">
                            <div className="flex justify-between items-center mb-2">
                            <label className="text-sm font-bold text-slate-700 flex items-center">
                                <FileText className="w-4 h-4 mr-2 text-blue-600" />
                                臨床文字內容 (Clinical Notes)
                            </label>
                            <div className="text-xs text-slate-400">支援中文、英文及常用縮寫</div>
                            </div>
                            
                            <textarea
                            className="flex-1 w-full p-4 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none font-mono text-sm leading-relaxed"
                            placeholder="請在此貼上臨床筆記...
例如：
Pt with h/o DM and HTN.
Impression:
1. Urosepsis/Septic shock
2. Klebsiella Pneumonia"
                            value={inputText}
                            onChange={(e) => setInputText(e.target.value)}
                            />
                            
                            <div className="mt-4 flex space-x-3">
                            <button 
                                onClick={handleAnalyze}
                                disabled={isProcessing || !inputText}
                                className={`flex-1 py-3 rounded-lg font-bold shadow-sm flex items-center justify-center transition-all ${
                                isProcessing || !inputText 
                                    ? 'bg-slate-200 text-slate-400 cursor-not-allowed' 
                                    : 'bg-blue-600 hover:bg-blue-700 text-white shadow-blue-200'
                                }`}
                            >
                                {isProcessing ? (
                                <span className="flex items-center">
                                    <span className="animate-spin mr-2">●</span> 分析中...
                                </span>
                                ) : (
                                <span className="flex items-center">
                                    <Search className="w-5 h-5 mr-2" /> 開始分析與編碼
                                </span>
                                )}
                            </button>
                            <button onClick={clearAll} className="px-4 py-3 bg-white border border-slate-300 text-slate-600 rounded-lg hover:bg-slate-50">
                                <Trash2 className="w-5 h-5" />
                            </button>
                            </div>
                        </div>
                        </div>

                        {/* Right Panel: Output */}
                        <div className="flex flex-col h-full overflow-hidden">
                        {isProcessing && (
                            <div className="mb-4 bg-white p-4 rounded-xl shadow-sm border border-slate-200 animate-pulse">
                            <div className="flex justify-between text-xs font-bold text-slate-500 mb-2">
                                <span className={progressStep >= 1 ? 'text-blue-600' : ''}>1. Extraction</span>
                                <span className={progressStep >= 2 ? 'text-blue-600' : ''}>2. Normalization</span>
                                <span className={progressStep >= 3 ? 'text-blue-600' : ''}>3. Coding</span>
                            </div>
                            <div className="w-full bg-slate-100 rounded-full h-2">
                                <div className="bg-blue-500 h-2 rounded-full transition-all duration-300" style={{ width: `${progressStep * 33.3}%` }}></div>
                            </div>
                            </div>
                        )}

                        <div className="flex-1 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                            <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                            <h2 className="font-bold text-slate-700 flex items-center">
                                <List className="w-4 h-4 mr-2 text-green-600" />
                                編碼結果
                            </h2>
                            {results.length > 0 && (
                                <button onClick={copyToClipboard} className="flex items-center text-xs bg-white border border-slate-300 px-3 py-1.5 rounded hover:bg-slate-50 text-slate-600">
                                <Copy className="w-3 h-3 mr-1" /> 複製
                                </button>
                            )}
                            </div>

                            <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-slate-50/50">
                            {results.length === 0 && !isProcessing && (
                                <div className="h-full flex flex-col items-center justify-center text-slate-400">
                                <Activity className="w-16 h-16 mb-4 opacity-20" />
                                <p>請輸入臨床筆記</p>
                                </div>
                            )}

                            {results.map((item, index) => (
                                <div key={index} className={`relative p-4 rounded-lg border-l-4 shadow-sm bg-white ${
                                item.type === 'unknown' ? 'border-l-red-400 border border-red-100' :
                                item.type === 'broad' ? 'border-l-amber-400 border border-amber-100' : 
                                'border-l-green-500 border border-slate-100'
                                }`}>
                                <div className="flex justify-between items-start mb-2">
                                    <div className="flex flex-col">
                                    <span className="text-xs font-mono bg-slate-100 text-slate-500 px-2 py-0.5 rounded w-fit mb-1">原始: {item.original}</span>
                                    {item.organ && item.organ !== 'Other' && (
                                        <span className={`text-[10px] w-fit px-2 py-0.5 rounded-full ${getOrganColor(item.organ)}`}>
                                        {getOrganLabel(item.organ)}
                                        </span>
                                    )}
                                    </div>
                                    <span className={`text-xl font-bold font-mono ${item.type === 'unknown' ? 'text-red-600' : 'text-blue-700'}`}>{item.code}</span>
                                </div>
                                <h3 className="text-lg font-semibold text-slate-800 mb-1">{item.standard}</h3>
                                {item.note && (
                                    <div className="mt-2 text-xs flex items-start bg-amber-50 text-amber-800 p-2 rounded">
                                    <AlertTriangle className="w-3 h-3 mr-1.5 mt-0.5 flex-shrink-0" />
                                    {item.note}
                                    </div>
                                )}
                                </div>
                            ))}
                            </div>
                        </div>
                        </div>
                    </div>
                    )}

                    {/* VIEW 2: DATABASE MANAGER */}
                    {activeTab === 'database' && (
                    <div className="h-full flex flex-col lg:flex-row gap-6">
                        {/* Add/Edit Rule Panel */}
                        <div className="lg:w-1/3 flex flex-col space-y-4">
                        <div className={`rounded-xl shadow-sm border p-5 overflow-y-auto transition-colors ${
                            editingId ? 'bg-amber-50 border-amber-200' : 'bg-white border-slate-200'
                        }`}>
                            <h2 className={`text-lg font-bold mb-4 flex items-center ${
                            editingId ? 'text-amber-800' : 'text-slate-800'
                            }`}>
                            {editingId ? (
                                <>
                                <Edit2 className="w-5 h-5 mr-2" /> 編輯規則
                                </>
                            ) : (
                                <>
                                <Plus className="w-5 h-5 mr-2 text-blue-600" /> 新增編碼規則
                                </>
                            )}
                            </h2>
                            
                            <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">ICD-10 Code</label>
                                <input 
                                    type="text" 
                                    className="w-full p-2 border border-slate-300 rounded font-mono focus:ring-2 focus:ring-blue-500 outline-none"
                                    placeholder="e.g. E11.9"
                                    value={newRule.code}
                                    onChange={(e) => setNewRule({...newRule, code: e.target.value})}
                                />
                                </div>
                                <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">器官/系統 (Organ)</label>
                                <select 
                                    className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-white"
                                    value={newRule.organ}
                                    onChange={(e) => setNewRule({...newRule, organ: e.target.value})}
                                >
                                    {ORGAN_CATEGORIES.map(cat => (
                                    <option key={cat.value} value={cat.value}>{cat.label}</option>
                                    ))}
                                </select>
                                </div>
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">標準診斷名稱 (Standard Term)</label>
                                <input 
                                type="text" 
                                className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="e.g. Type 2 diabetes mellitus"
                                value={newRule.standard}
                                onChange={(e) => setNewRule({...newRule, standard: e.target.value})}
                                />
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">識別關鍵字 (用逗號分隔)</label>
                                <textarea 
                                className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none h-20 text-sm"
                                placeholder="例如: DM, 糖尿病, Sugar high"
                                value={newRule.keywords}
                                onChange={(e) => setNewRule({...newRule, keywords: e.target.value})}
                                />
                                <p className="text-[10px] text-slate-400 mt-1">
                                {editingId ? '您可以在此處增修更多關鍵字。' : '系統會自動識別這些關鍵字並轉換為上方代碼。'}
                                </p>
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">匹配類型 (Type)</label>
                                <select 
                                className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-white"
                                value={newRule.type}
                                onChange={(e) => setNewRule({...newRule, type: e.target.value})}
                                >
                                <option value="exact">Exact (精確)</option>
                                <option value="broad">Broad (廣泛/需細分)</option>
                                <option value="context">Context (背景資訊)</option>
                                </select>
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-slate-500 mb-1">備註/警示 (選填)</label>
                                <input 
                                type="text" 
                                className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"
                                placeholder="提示使用者注意併發症..."
                                value={newRule.note}
                                onChange={(e) => setNewRule({...newRule, note: e.target.value})}
                                />
                            </div>

                            <div className="flex space-x-2">
                                {editingId && (
                                <button 
                                    onClick={handleCancelEdit}
                                    className="flex-1 py-2 bg-white border border-slate-300 text-slate-600 rounded-lg font-bold hover:bg-slate-50 transition-colors flex items-center justify-center"
                                >
                                    <XCircle className="w-4 h-4 mr-2" />
                                    取消
                                </button>
                                )}
                                <button 
                                onClick={handleSaveRule}
                                className={`flex-1 py-2 text-white rounded-lg font-bold shadow-md transition-colors flex items-center justify-center ${
                                    editingId ? 'bg-amber-600 hover:bg-amber-700' : 'bg-blue-600 hover:bg-blue-700'
                                }`}
                                >
                                <Save className="w-4 h-4 mr-2" />
                                {editingId ? '更新規則' : '儲存到規則庫'}
                                </button>
                            </div>
                            </div>
                        </div>

                        <div className="bg-blue-50 rounded-xl p-4 text-xs text-blue-800 border border-blue-100">
                            <p>💡 提示：您可以利用新增的「排序」按鈕來依照器官系統或代碼整理規則，方便快速查找。</p>
                        </div>
                        </div>

                        {/* Existing Rules List */}
                        <div className="flex-1 bg-white rounded-xl shadow-sm border border-slate-200 flex flex-col overflow-hidden">
                        {/* Header with Sort Controls */}
                        <div className="p-4 border-b border-slate-100 flex flex-col gap-3 bg-slate-50">
                            <div className="flex justify-between items-center">
                            <h2 className="font-bold text-slate-700">目前規則庫 ({sortedDatabase.length})</h2>
                            
                            {/* Action Buttons */}
                            <div className="flex items-center space-x-2">
                                <button onClick={handleExportDb} className="text-xs flex items-center text-blue-600 hover:bg-blue-50 px-2 py-1 rounded border border-blue-200 transition-colors" title="備份資料庫 (.json)">
                                <Download className="w-3 h-3 mr-1" /> 備份
                                </button>
                                <button onClick={handleImportClick} className="text-xs flex items-center text-emerald-600 hover:bg-emerald-50 px-2 py-1 rounded border border-emerald-200 transition-colors" title="還原資料庫 (.json)">
                                <Upload className="w-3 h-3 mr-1" /> 匯入
                                </button>
                                <button onClick={handleCopyForDeveloper} className="text-xs flex items-center text-purple-600 hover:bg-purple-50 px-2 py-1 rounded border border-purple-200 transition-colors" title="複製完整資料庫 (給開發者)">
                                <Code className="w-3 h-3 mr-1" /> 給開發者
                                </button>
                                <div className="h-4 w-px bg-slate-300 mx-1"></div>
                                <button onClick={handleSmartResetDb} className="text-xs text-red-500 hover:text-red-700 underline flex items-center" title="重置為系統預設值 (保留自訂規則)">
                                <RotateCcw className="w-3 h-3 mr-1" /> 重置預設值
                                </button>
                            </div>
                            </div>
                            
                            {/* Sort Control Bar */}
                            <div className="flex items-center gap-2 text-xs">
                            <span className="text-slate-500 font-bold">排序方式 (Sort by):</span>
                            <div className="flex bg-white rounded border border-slate-200 p-0.5">
                                <button 
                                onClick={() => requestSort('code')}
                                className={`px-3 py-1 rounded flex items-center transition-colors ${
                                    sortConfig.key === 'code' ? 'bg-blue-100 text-blue-700 font-bold' : 'text-slate-600 hover:bg-slate-50'
                                }`}
                                >
                                Code <SortIcon colKey="code" />
                                </button>
                                <button 
                                onClick={() => requestSort('organ')}
                                className={`px-3 py-1 rounded flex items-center transition-colors ${
                                    sortConfig.key === 'organ' ? 'bg-blue-100 text-blue-700 font-bold' : 'text-slate-600 hover:bg-slate-50'
                                }`}
                                >
                                Organ <SortIcon colKey="organ" />
                                </button>
                                <button 
                                onClick={() => requestSort('standard')}
                                className={`px-3 py-1 rounded flex items-center transition-colors ${
                                    sortConfig.key === 'standard' ? 'bg-blue-100 text-blue-700 font-bold' : 'text-slate-600 hover:bg-slate-50'
                                }`}
                                >
                                Term <SortIcon colKey="standard" />
                                </button>
                            </div>
                            </div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-0">
                            <table className="w-full text-sm text-left">
                            <thead className="text-xs text-slate-500 uppercase bg-slate-50 sticky top-0 shadow-sm z-10">
                                <tr>
                                <th className="px-4 py-3 cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => requestSort('code')}>
                                    <div className="flex items-center">Code / Organ <SortIcon colKey="code" /></div>
                                </th>
                                <th className="px-4 py-3 cursor-pointer hover:bg-slate-100 transition-colors" onClick={() => requestSort('standard')}>
                                    <div className="flex items-center">Term & Keywords <SortIcon colKey="standard" /></div>
                                </th>
                                <th className="px-4 py-3 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-100">
                                {sortedDatabase.map((item) => (
                                <tr key={item.id} className={`hover:bg-slate-50 ${editingId === item.id ? 'bg-amber-50' : ''}`}>
                                    <td className="px-4 py-3 font-mono align-top w-32">
                                    <div className="font-bold text-blue-700">{item.code}</div>
                                    {/* 顯示 Organ 標籤 */}
                                    <div className={`mt-1 text-[10px] w-fit px-1.5 py-0.5 rounded ${getOrganColor(item.organ)}`}>
                                        {getOrganLabel(item.organ || 'Other')}
                                    </div>
                                    {item.type === 'broad' && <div className="mt-1 text-[10px] bg-amber-100 text-amber-800 px-1 rounded w-fit">Broad</div>}
                                    {item.type === 'context' && <div className="mt-1 text-[10px] bg-purple-100 text-purple-800 px-1 rounded w-fit">Context</div>}
                                    </td>
                                    <td className="px-4 py-3 align-top">
                                    <div className="font-medium text-slate-800">{item.standard}</div>
                                    <div className="mt-1 flex flex-wrap gap-1">
                                        {item.keywords.map((k, i) => (
                                        <span key={i} className="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded border border-slate-200">
                                            {k}
                                        </span>
                                        ))}
                                    </div>
                                    {item.note && <div className="text-[10px] text-amber-600 mt-1 italic">{item.note}</div>}
                                    </td>
                                    <td className="px-4 py-3 text-right align-top whitespace-nowrap">
                                    <button 
                                        onClick={() => handleEditRule(item)}
                                        className={`p-1 rounded transition-colors mr-2 ${
                                        editingId === item.id 
                                            ? 'text-amber-600 bg-amber-100' 
                                            : 'text-slate-400 hover:text-blue-600 hover:bg-blue-50'
                                        }`}
                                        title="編輯"
                                    >
                                        <Edit2 className="w-4 h-4" />
                                    </button>
                                    <button 
                                        onClick={() => handleDeleteRule(item.id)}
                                        className="text-slate-400 hover:text-red-500 p-1 rounded hover:bg-red-50 transition-colors"
                                        title="刪除"
                                    >
                                        <Trash2 className="w-4 h-4" />
                                    </button>
                                    </td>
                                </tr>
                                ))}
                            </tbody>
                            </table>
                        </div>
                        </div>
                    </div>
                    )}

                </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>